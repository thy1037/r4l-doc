<!DOCTYPE HTML>
<html lang="zh" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Docker 安装 - r4l</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="env.html"><strong aria-hidden="true">1.</strong> 环境搭建</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="env_docker.html" class="active"><strong aria-hidden="true">1.1.</strong> Docker 安装</a></li><li class="chapter-item expanded "><a href="env_docker_config.html"><strong aria-hidden="true">1.2.</strong> Docker 配置</a></li><li class="chapter-item expanded "><a href="env_01.html"><strong aria-hidden="true">1.3.</strong> qemu + linux6.1</a></li><li class="chapter-item expanded "><a href="env_02.html"><strong aria-hidden="true">1.4.</strong> qemu + gdb (TODO)</a></li><li class="chapter-item expanded "><a href="env_03.html"><strong aria-hidden="true">1.5.</strong> qemu + vscode (TODO)</a></li></ol></li><li class="chapter-item expanded "><a href="c.html"><strong aria-hidden="true">2.</strong> C 驱动开发</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="c_01.html"><strong aria-hidden="true">2.1.</strong> 最简驱动体验</a></li><li class="chapter-item expanded "><a href="c_02.html"><strong aria-hidden="true">2.2.</strong> 其它 (TODO)</a></li></ol></li><li class="chapter-item expanded "><a href="rust.html"><strong aria-hidden="true">3.</strong> rust 驱动开发</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="rust_01.html"><strong aria-hidden="true">3.1.</strong> 最简驱动体验</a></li><li class="chapter-item expanded "><a href="rust_mini_ko.html"><strong aria-hidden="true">3.2.</strong> 编译最简 ko 模块</a></li><li class="chapter-item expanded "><a href="rust_fujita_e1000.html"><strong aria-hidden="true">3.3.</strong> linux-fujita + e1000</a></li><li class="chapter-item expanded "><a href="rust_stm32h743_eth_c.html"><strong aria-hidden="true">3.4.</strong> STM32H743 以太网外设初始化分析</a></li><li class="chapter-item expanded "><a href="rust_add_llvm_log.html"><strong aria-hidden="true">3.5.</strong> LLVM 修复记录</a></li><li class="chapter-item expanded "><a href="rust_register_cmp.html"><strong aria-hidden="true">3.6.</strong> 寄存器对比</a></li><li class="chapter-item expanded "><a href="rust_register_info.html"><strong aria-hidden="true">3.7.</strong> 寄存器说明</a></li><li class="chapter-item expanded "><a href="rust_c_drv.html"><strong aria-hidden="true">3.8.</strong> C 驱动分析</a></li><li class="chapter-item expanded "><a href="rust_02.html"><strong aria-hidden="true">3.9.</strong> 其它 (TODO)</a></li></ol></li><li class="chapter-item expanded "><a href="other.html"><strong aria-hidden="true">4.</strong> 其它</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="other_git_depth_checkout.html"><strong aria-hidden="true">4.1.</strong> depth 1 情况下切换分支</a></li></ol></li><li class="chapter-item expanded "><a href="iic-rust.html"><strong aria-hidden="true">5.</strong> IIC 驱动开发 (TODO)</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">r4l</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/thy1037/r4l-doc" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="docker-安装"><a class="header" href="#docker-安装">Docker 安装</a></h1>
<p>为了统一开发环境，同时于其它开发环境做隔离，选择在 Docker 中做开发。</p>
<p>主要参考<a href="https://docs.docker.com/engine/install/">官网</a>的 <a href="https://docs.docker.com/engine/install/">Debian 系统安装教程</a></p>
<h2 id="卸载旧版本"><a class="header" href="#卸载旧版本">卸载旧版本</a></h2>
<pre><code class="language-bash">sudo apt remove docker docker-engine docker.io containerd runc
</code></pre>
<p>其中：</p>
<p><code>docker-engin</code> 在 Debian 仓库中已不存在，所以可能会报错，删除后重新执行即可。</p>
<h2 id="使用仓库安装"><a class="header" href="#使用仓库安装">使用仓库安装</a></h2>
<p>Docker 支持多种安装方式，这里选择通过 apt 仓库的形式安装。</p>
<h3 id="设置仓库"><a class="header" href="#设置仓库">设置仓库</a></h3>
<ol>
<li>更新 apt 包索引，并允许 apt 通过 HTTPS 使用仓库：</li>
</ol>
<pre><code class="language-bash">sudo apt update
sudo apt install ca-certificates curl gnupg
</code></pre>
<ol start="2">
<li>添加 Docker 的官方 GPG 密钥：</li>
</ol>
<pre><code class="language-bash">sudo install -m 0755 -d /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/debian/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
sudo chmod a+r /etc/apt/keyrings/docker.gpg
</code></pre>
<ol start="3">
<li>使用以下命令设置仓库</li>
</ol>
<pre><code class="language-bash">echo \
  &quot;deb [arch=&quot;$(dpkg --print-architecture)&quot; signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/debian \
  &quot;$(. /etc/os-release &amp;&amp; echo &quot;$VERSION_CODENAME&quot;)&quot; stable&quot; | \
  sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null
</code></pre>
<h3 id="安装-docker-engine"><a class="header" href="#安装-docker-engine">安装 Docker Engine</a></h3>
<ol>
<li>更新 apt 包索引</li>
</ol>
<pre><code class="language-bash">sudo apt update
</code></pre>
<ol start="2">
<li>安装 Docker Engine, containerd 和 Docker Compose</li>
</ol>
<p>最新版：</p>
<pre><code class="language-bash">sudo apt install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
</code></pre>
<ol start="3">
<li>通过运行 <code>hello-world</code> 镜像来确认 Docker Engine 安装成功：</li>
</ol>
<pre><code class="language-bash">sudo docker run hello-world
</code></pre>
<p>成功输出：</p>
<pre><code class="language-bash">Unable to find image 'hello-world:latest' locally
latest: Pulling from library/hello-world
2db29710123e: Pull complete 
Digest: sha256:4e83453afed1b4fa1a3500525091dbfca6ce1e66903fd4c01ff015dbcb1ba33e
Status: Downloaded newer image for hello-world:latest

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.
    (amd64)
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/
</code></pre>
<h2 id="debian-镜像"><a class="header" href="#debian-镜像">Debian 镜像</a></h2>
<p>因为个人喜好，并且宿主机使用的 Debian 系统，所以 Docker 中依旧选择 Debian，但要说的是 Ubuntu 是支持最完善的系统镜像。</p>
<h2 id="安装镜像"><a class="header" href="#安装镜像">安装镜像</a></h2>
<p>通过运行 <code>hello-world</code> 发现，在本地没有镜像的情况下，Docker 会自动从<a href="https://hub.docker.com/">官方镜像仓库</a>中下载，所以执行运行：</p>
<pre><code class="language-bash">sudo docker run -it debian bash
</code></pre>
<p>其中：</p>
<p><strong>-i</strong>：开启交互（interactive） <br>
<strong>-t</strong>：开启终端（pseudo-TTY） <br>
<strong>debian</strong>：镜像名称 <br>
<strong>bash</strong>：应用名称</p>
<p>输出如下：</p>
<pre><code class="language-bash">Unable to find image 'debian:latest' locally
latest: Pulling from library/debian
b0248cf3e63c: Pull complete 
Digest: sha256:0a78ed641b76252739e28ebbbe8cdbd80dc367fba4502565ca839e5803cfd86e
Status: Downloaded newer image for debian:latest
root@8bfa66c20540:/# 
</code></pre>
<p>这是一个非常基础的 Debian 系统，在安装过程中可以看到下载的大小只有 55M 左右，其中包含的命令（可执行文件）非常少，需要根据使用需求安装各种开发工具。</p>
<h2 id="添加-sudo-权限"><a class="header" href="#添加-sudo-权限">添加 sudo 权限</a></h2>
<p>正常在安装完 Docker 后，所有命令都需要 sudo 权限，使用很不方便（但安全），可以将 docker 加入 sudo 用户组，即默认 sudo 权限运行，具体步骤如下：</p>
<ol>
<li>创建用户组
首先查看是否有用户组：</li>
</ol>
<pre><code class="language-bash">cat /etc/group | grep docker
</code></pre>
<p>如果没有则创建用户组：</p>
<pre><code class="language-bash">sudo groupadd docker
</code></pre>
<ol start="2">
<li>当前用户加入用户组</li>
</ol>
<pre><code class="language-bash">sudo gpasswd -a ${USER} docker
</code></pre>
<ol start="3">
<li>重启 docker 服务</li>
</ol>
<pre><code class="language-bash">sudo service docker restart
</code></pre>
<ol start="4">
<li>docker.sock 添加权限</li>
</ol>
<pre><code class="language-bash">sudo chmod a+r2 /var/run/docker.sock
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="env.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="env_docker_config.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="env.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="env_docker_config.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
